import{u as C,r as S,j as e,H as D,L as g}from"./app-BcFT7WYG.js";import{A as k}from"./AuthenticatedLayout-BOAfC5sU.js";import"./transition-B_sySLsM.js";function A({proveedores:b,materiales:o}){const{data:n,setData:p,post:f,processing:h,errors:d}=C({proveedor_id:"",fecha_compra:new Date().toISOString().split("T")[0],detalles:[]}),[i,m]=S.useState([{material_id:"",cantidad:"",precio_unitario:""}]),j=t=>{t.preventDefault();const s=i.map(r=>({...r,cantidad:c(r.cantidad),precio_unitario:c(r.precio_unitario)}));n.detalles=s,f(route("compras.store"))},y=()=>{m([...i,{material_id:"",cantidad:"",precio_unitario:""}])},N=t=>{const s=i.filter((r,a)=>a!==t);m(s)},v=t=>t?t.toString().replace(".",","):"",c=t=>t&&parseFloat(t.toString().replace(",","."))||0,u=(t,s,r)=>{const a=[...i];if(!((s==="cantidad"||s==="precio_unitario")&&!/^[0-9]*,?[0-9]*$/.test(r)&&r!=="")){if(a[t][s]=r,s==="material_id"&&r){const l=o.find(w=>w.id==r);l&&l.precio_dia_compra&&(a[t].precio_unitario=v(l.precio_dia_compra))}m(a)}},_=()=>i.reduce((t,s)=>{const r=c(s.cantidad),a=c(s.precio_unitario);return t+r*a},0),x=t=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(t);return e.jsxs(k,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Nueva Compra"}),e.jsx(g,{href:route("compras.index"),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"Volver"})]}),children:[e.jsx(D,{title:"Nueva Compra"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-6xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Proveedor *"}),e.jsxs("select",{value:n.proveedor_id,onChange:t=>p("proveedor_id",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar proveedor"}),b.map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," - ",t.documento]},t.id))]}),d.proveedor_id&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:d.proveedor_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha de Compra *"}),e.jsx("input",{type:"date",value:n.fecha_compra,onChange:t=>p("fecha_compra",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Se establece automÃ¡ticamente con la fecha actual"}),d.fecha_compra&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:d.fecha_compra})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detalles de la Compra"}),e.jsx("button",{type:"button",onClick:y,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",children:"+ Agregar Material"})]}),e.jsx("p",{className:"mt-2 text-xs text-blue-600 bg-blue-50 p-2 rounded",children:"ðŸ’¡ Los precios unitarios se completarÃ¡n automÃ¡ticamente con el precio del dÃ­a al seleccionar un material. Use coma (,) como separador decimal, ejemplo: 10,50"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Unidad"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Precio Unitario"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Subtotal"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((t,s)=>{const r=o.find(a=>a.id==t.material_id);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{value:t.material_id,onChange:a=>u(s,"material_id",a.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar material..."}),o.map(a=>e.jsxs("option",{value:a.id,children:[a.nombre," (",a.unidad_medida,")",a.precio_dia_compra?` - ${x(a.precio_dia_compra)}`:""]},a.id))]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:r?r.unidad_medida:"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:t.cantidad,onChange:a=>u(s,"cantidad",a.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:r?`Ej: 10,50 ${r.unidad_medida}`:"Ej: 10,50",required:!0})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:t.precio_unitario,onChange:a=>u(s,"precio_unitario",a.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:r?.precio_dia_compra?"Precio del dÃ­a cargado":"Ej: 15000,50",required:!0})}),e.jsx("td",{className:"px-4 py-2 text-sm font-semibold",children:x(c(t.cantidad)*c(t.precio_unitario))}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>N(s),className:"text-red-600 hover:text-red-900",disabled:i.length===1,children:"Eliminar"})})]},s)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-4 py-3 text-right font-semibold",children:"Total:"}),e.jsx("td",{className:"px-4 py-3 text-lg font-bold text-green-600",children:x(_())}),e.jsx("td",{})]})})]})}),d.detalles&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:d.detalles})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(g,{href:route("compras.index"),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:h?"Guardando...":"Guardar Compra"})]})]})})})})]})}export{A as default};
