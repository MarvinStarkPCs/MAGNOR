import{u as w,r as _,j as e,H as k,L as g}from"./app-DnThth6Z.js";import{A as C}from"./AuthenticatedLayout-Bp70gWL-.js";import"./transition-CYogjAe4.js";function q({clientes:b,materiales:x}){const{data:d,setData:u,post:f,processing:m,errors:l}=w({cliente_id:"",fecha:new Date().toISOString().split("T")[0],detalles:[]}),[r,n]=_.useState([{material_id:"",cantidad:"",precio_unitario:""}]),j=t=>{t.preventDefault(),d.detalles=r,f(route("ventas.store"))},y=()=>{n([...r,{material_id:"",cantidad:"",precio_unitario:""}])},v=t=>{const s=r.filter((a,i)=>i!==t);n(s)},c=(t,s,a)=>{const i=[...r];i[t][s]=a,n(i)},o=t=>{const s=x.find(a=>a.id==t);return s?s.stock:0},N=()=>r.reduce((t,s)=>{const a=parseFloat(s.cantidad)||0,i=parseFloat(s.precio_unitario)||0;return t+a*i},0),p=t=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(t),h=t=>{const s=r[t];if(s.material_id&&s.cantidad){const a=o(s.material_id);return parseFloat(s.cantidad)<=a}return!0};return e.jsxs(C,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Nueva Venta"}),e.jsx(g,{href:route("ventas.index"),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"Volver"})]}),children:[e.jsx(k,{title:"Nueva Venta"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-6xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente *"}),e.jsxs("select",{value:d.cliente_id,onChange:t=>u("cliente_id",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar cliente"}),b.map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," - ",t.documento]},t.id))]}),l.cliente_id&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:l.cliente_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha *"}),e.jsx("input",{type:"date",value:d.fecha,onChange:t=>u("fecha",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0}),l.fecha&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:l.fecha})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detalles de la Venta"}),e.jsx("button",{type:"button",onClick:y,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",children:"+ Agregar Material"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Stock"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Precio Unitario"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Subtotal"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{value:t.material_id,onChange:a=>c(s,"material_id",a.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar"}),x.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]})}),e.jsx("td",{className:"px-4 py-2",children:t.material_id&&e.jsx("span",{className:`text-sm font-semibold ${o(t.material_id)<10?"text-red-600":"text-gray-900"}`,children:o(t.material_id)})}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("input",{type:"number",step:"0.01",value:t.cantidad,onChange:a=>c(s,"cantidad",a.target.value),className:`block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 ${h(s)?"":"border-red-500"}`,required:!0}),!h(s)&&e.jsx("span",{className:"text-xs text-red-600",children:"Stock insuficiente"})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.precio_unitario,onChange:a=>c(s,"precio_unitario",a.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})}),e.jsx("td",{className:"px-4 py-2 text-sm font-semibold",children:p((parseFloat(t.cantidad)||0)*(parseFloat(t.precio_unitario)||0))}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>v(s),className:"text-red-600 hover:text-red-900",disabled:r.length===1,children:"Eliminar"})})]},s))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-4 py-3 text-right font-semibold",children:"Total:"}),e.jsx("td",{className:"px-4 py-3 text-lg font-bold text-green-600",children:p(N())}),e.jsx("td",{})]})})]})}),l.detalles&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:l.detalles})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(g,{href:route("ventas.index"),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:m?"Guardando...":"Guardar Venta"})]})]})})})})]})}export{q as default};
